{% extends 'base.html' %}

{% block title %}Mozilla FlightDeck Site Status{% endblock title %}

{% block app_content %}

<h2 class="UI_Heading" style="padding-top: 3em">Filepaths</h2>
<dl>
{% for path, exists, permissions, extra in filepaths %}
  <dt style="font-weight: bold">{{ path }}</dt>
  <dd style="padding-bottom: 1em">
  {% if exists %}
    Exists...
  {% else %}
    <b style="color: red">Does not exist</b>
  {% endif %}

  {% if permissions %}
    with proper permissions.
  {% else %}
    <b>and does not have the permissions we expect.</b>
  {% endif %}
  {% if extra %}
    ({{ extra }})
  {% endif %}
  </dd>
{% endfor %}
</dl>

<h2 class="UI_Heading" style="padding-top: 3em">Free space</h2>
<ul>
  {% for path, size in free.items %}
  <li>{{ path }}:  {{ size }}kB</li>
  {% endfor %}
</ul>

<h2 class="UI_Heading" style="padding-top: 3em">Celery touches file</h2>
<p id='monitor_file_result'>Waiting...</p>

<script type="text/javascript">
  window.addEvent('load', function(){
    (function(){
      var monitor_file_result = $('monitor_file_result');
      new Request.JSON({ 
        url: '{% url monitor_file %}',
        method: 'post',
        data: {
          'monitor_file': '{{ monitor_file }}'
        },
        onSuccess: function(result) {
          if (!result.success) {
            monitor_file_result.set('text', 'FAIL');
            return;
          }
          new Request.JSON({ 
            url: '{% url monitor_file %}',
            method: 'post',
            data: {
              'monitor_file': '{{ monitor_file }}'
            },
            onSuccess: function(result) {
              monitor_file_result.set('text',  
                (result.success) 
                  ? 'FAIL - file received but not deleted' : 'SUCCESS');
            }
          }).send();
        }
      }).send();
    }).delay(1000);
  });
</script>


{% endblock %}
